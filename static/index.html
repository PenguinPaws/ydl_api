<!DOCTYPE html>

<html lang="en">
<head>
    <!-- Disable caching -->
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="expires" content="0" />

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>YDL API</title>

    <!-- Changing to below to always never cache the css
    <link rel="stylesheet" href="/static/css/ydl_api.css?v=1.0" type="text/css" />
    -->
    <script>
        document.write('<link rel="stylesheet" href="/static/css/ydl_api.css?r='+ (new Date()).getTime() +'" type="text/css" />');
    </script>

</head>

<body>
    <div class="mainContent">
        <div class="button_cont" align="center">
            <a class="mainButtons" href="/docs" target="_self" rel="nofollow noopener noreferrer" draggable="false">SwaggerUI Docs</a>
            <a class="mainButtons" href="/redoc" target="_self" rel="nofollow noopener noreferrer" draggable="false">ReDoc Docs</a>
        </div>
        <div class="button_cont" align="center">
            <a class="bookmarkletButton" href="/userscript.js" target="_self" rel="nofollow noopener">TamperMonkey / GreaseMonkey Script</a>
        </div>
        <div class="bookmarkletContainer" align="center">
            <span>Bookmarklet: </span>
            <a id="bookmarklet" href>YDL API Bookmarklet</a>
        </div>
    </div>
</body>

<script>
    // Inspiration - https://github.com/caiorss/bookmarklet-maker
    function generateBookmarklet (){
        /* Customizable settings */
        let elmID = "bookmarklet"
        let title = "YDL Download";
        let host = window.location.href;
        host = (host.substr(-1) === '/') ? host.slice(0, -1) : host;  /* Remove any trailing slash*/
        let endpoint = '/download?url=';
        let videoURL = "window.location.href.split('&')[0]";
        
        /* Assembles values provided */
        let code = `var newURL = '${host}${endpoint}' + ${videoURL}; window.location = newURL; `;
        let output = `javascript: (function(){ ${code.trim()} })();`;
        
        /* Updates the bookmarklet link on the page */
        let link  = document.getElementById( elmID );
        link.text = title;
        link.href = output;
    }

    generateBookmarklet();
</script>
</html>